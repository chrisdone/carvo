var dark = "#222";

var a_ = [s(1),l(0.02),,,l(0.04),,l(0.02),,,,r(0.01),s(0.5),,r(0.05),,r(0.5),,l(0.05),,s(0.5),,l(0.05),,s(0.1),l(0.1),,l(0.1),,l(0.1),,l(0.05),,l(0.1),,s(0.4),,l(0.05),,l(0.01),,l(0.02),,l(0.5),s(1.6),,s(0.1),l(0.2),,l(0.1),,a(0),,s(2),,];

var b_ = [s(1),l(0.02),,l(0.04),,l(0.05),,,s(7),,l(0.5),s(8.2),,s(1),l(0.44),,,s(0.5),r(0.02),,s(0.3),r(0.2),,r(0.2),,,r(0.06),,r(0.04),,r(0.01),,s(0.5),,,,,,,,l(0.5),a(0),s(4.6),,];

var c_ = [s(1),l(0.03),,l(0.01),,s(1),,l(0.02),,l(0.01),,r(0.01),,,l(0.5),s(2.7),,s(0.2),l(0.1),,l(0.1),,l(0.1),,l(0.1),,,,,a(0),,s(2.7),,];

var d_ = [s(1),l(0.03),,l(0.02),,s(0.5),,l(0.05),,l(0.05),,r(0.07),,r(0.08),,r(0.08),,l(0.5),,l(0.05),,l(0.05),,l(0.07),,l(0.05),,s(0.5),,l(0.2),,l(0.15),,l(0.1),,l(0.018),,s(7.4),,l(0.5),s(7.1),,l(0.05),s(0.3),,l(0.1),,l(0.2),,l(0.04),s(1.8),,];

var e_ = [s(1),l(0.03),,l(0.01),,s(1.5),,s(0.3),l(0.01),,l(0.01),,l(0.04),,l(0.1),,l(0.2),,l(0.1),,l(0.01),,l(0.05),,l(0.05),,l(0.01),,l(0.01),,l(0.01),,,,l(0.01),,,l(0.01),,l(0.01),,l(0.1),,s(0.3),l(0.05),,l(0.1),,l(0.05),,,l(0.02),,a(0),s(2.6),,];

var f_ = [s(1),l(0.03),,l(0.01),,s(1),l(0.05),,l(0.04),,s(2.7),,l(0.5),s(10.55),,l(0.5),s(5.2),,s(2),a(0),,];

var g_ = [s(1),l(0.03),,l(0.01),,s(1),,l(0.05),,s(0.2),r(0.05),,,r(0.01),,l(0.5),,l(0.01),,,,l(0.01),,l(0.02),,s(1),,s(0.2),l(0.2),,l(0.1),,l(0.15),,s(0.5),,l(0.13),,,,l(0.5),r(0.02),s(6.1),,l(0.5),s(4.5),,a(0),s(2.4),,];

var h_ = [s(0.7),l(0.001),,l(0.03),,l(0.08),s(9),,l(0.5),,l(0.45),s(2.5),,r(0.37),s(1.1),,s(0.3),l(0.1),,l(0.2),,a(0),,s(2),,];

var i_ = [s(0.7),l(0.001),,l(0.03),,l(0.03),,l(0.03),,l(0.03),,l(0.01),,,,,l(0.5),s(1.3),,s(0.2),l(0.1),,l(0.1),,l(0.05),,,,l(0.1),,a(0),,s(1.4),,];

var j_ = [s(1),l(0.03),,l(0.01),,s(1),l(0.05),,l(0.04),,s(1.4),,l(0.5),s(9),,l(0.5),s(4.9),,s(2),a(0),,];

var k_ = [s(1),l(0.04),,l(0.03),,l(0.02),,l(0.03),,s(6),,l(0.5),s(6.5),,s(0.1),l(0.2),,l(0.2),,s(0.5),,l(0.05),,l(0.02),,s(1),,l(0.5),s(2),,s(0.2),l(0.1),,l(0.15),,,,,l(0.1),,a(0),,s(2),,];

var l_ = [s(1),l(0.04),,l(0.03),,l(0.02),,l(0.03),,s(6),,l(0.515),s(7.255),,s(0.1),l(0.15),,l(0.2),,s(0.5),,s(2),a(0),,];

var m_ = [s(1),l(0.02),,l(0.03),,l(0.05),,s(2),,s(0.2),r(0.01),,r(0.01),,r(0.01),,r(0.05),,r(0.1),,r(0.1),,,,r(0.2),,,r(0.005),,s(1.6),,l(0.5),s(1.2),,r(0.02),,s(0.1),r(0.1),,,r(0.2),,r(0.15),,s(2),,l(0.05),s(0.1),,l(0.1),,a(0),,s(1.9),,];

var n_ = [s(1),l(0.02),,l(0.03),,l(0.05),,s(1),,s(0.2),r(0.05),, r(0.05),r(0.1),r(0.2),,,r(0.005),,s(1),,l(0.5),s(1),,r(0.02),,s(0.1),r(0.1),,,r(0.2),,r(0.15),,s(1.4),,l(0.05),s(0.1),,l(0.1),,a(0),,s(1.9),,];

var o_ = [s(1),l(0.02),,l(0.03),,l(0.02),,l(0.02),,r(0.01),,s(0.1),,,r(0.2),,r(0.05),,r(0.05),,r(0.05),,r(0.05),,r(0.05),,,s(0.2),,,r(0.05),,r(0.05),,r(0.05),,r(0.05),,r(0.1),,r(0.1),,r(0.05),,r(0.05),,r(0.05),,r(0.01),,,s(1.4),,s(0.2),r(0.1),,r(0.1),,r(0.1),,s(0.7),,s(0.2),l(0.1),,l(0.1),,a(0),s(1),,];

var p_ = [s(1),l(0.01),,l(0.01),s(2.5),,s(0.3),l(0.05),,l(0.05),,l(0.05),,l(0.05),,l(0.1),,l(0.1),,l(0.1),,l(0.1),s(7.8),,l(0.5),s(5),,a(0),s(3),,];

var q_ = [s(1),l(0.02),,l(0.03),,l(0.02),,l(0.025),,,r(0.05),,l(0.5),,l(0.02),,l(0.02),,l(0.05),,l(0.05),,l(0.1),,l(0.2),,,,l(0.1),,l(0.04),s(1.5),,l(0.5),s(7),,l(0.5),s(4.95),,a(0),s(2),,];

var r_ = [s(1),l(0.02),,l(0.05),,l(0.05),,l(0.05),,r(0.2),,l(0.05),,l(0.5),,r(0.05),,l(0.2),,r(0.02),,r(0.02),,r(0.02),,l(0.1),,l(0.2),,l(0.1),a(0),,s(1),,];

var s_ = [s(1),l(0.02),,l(0.01),,l(0.05),,l(0.02),,l(0.02),,s(0.1),l(0.02),,,r(0.4),s(0.4),,r(0.05),,r(0.05),,,r(0.05),,,r(0.05),,,r(0.05),,a(0),,s(2.5),,];

var t_ = [s(1),l(0.02),,l(0.03),,l(0.02),,l(0.025),,l(0.025),,s(4.2),,l(0.5),s(3.4),,l(0.4),s(1.5),,l(0.5),,l(0.1),s(2.5),,s(0.2),l(0.1),,l(0.2),,l(0.1),,a(0),,s(1.3),,];

var u_ = [s(1),l(0.02),,l(0.03),,l(0.02),,l(0.025),,l(0.025),,l(0.53),s(1.3),,s(0.2),l(0.1),,l(0.1),,l(0.1),,l(0.1),,l(0.05),,l(0.05),,s(2),,l(0.5),s(2.2),,a(0),,];

var v_ = [s(1),l(0.02),,l(0.03),,l(0.02),,l(0.025),,,l(0.7),s(1.5),,l(0.4),s(1.6),,s(1.3),r(0.4),,s(0.5),l(0.1),,l(0.1),,a(0),s(0.5),,];

var w_ = [s(1),l(0.02),,l(0.03),,l(0.02),,l(0.025),,,l(0.7),s(1.5),,l(0.4),s(1.5),,s(1.7),r(0.4),,l(0.4),s(1.7),,r(0.35),,s(0.2),l(0.05),,l(0.05),,a(0),s(0.4),,];

var x_ = [s(1),l(0.02),,l(0.05),,l(0.05),,s(0.6),r(0.01),,r(0.1),,r(0.1),,r(0.15),,r(0.15),,r(0.05),,r(0.02),,l(0.55),,s(2),,s(0.2),r(0.02),,r(0.02),,r(0.02),,l(0.55),s(1.3),,s(0.16),l(0.1),,,l(0.1),,,l(0.1),,l(0.05),,,l(0.005),,,,l(0.05),,,l(0.05),,,,a(0),s(1.5),,];

var y_ = [s(1.2),l(0.02),,l(0.05),,l(0.05),,s(0.4),r(0.01),,s(1.3),l(0.5),,s(0.2),l(0.05),,l(0.1),,l(0.1),,,l(0.1),,,l(0.1),,,s(0.5),,s(0.1),l(0.07),s(1.8),,l(0.49),s(7),,l(0.5),s(4.35),,a(0),s(2),,];

var horizontalLines = {
  ascenderHeight: 0.1,
  capHeight: 0.125,
  median: 0.35,
  baseline: { value: 0.42 },
  descenderHeight: 0.575
};

var verticalLines = {
  leftMargin: 0.1,
  lead: 0.15,
  origin: { value: 0.175 },
  advance: 0.25,
  trail: 0.275
};

var dimensions = {
  width: 300,
  height: 300
};

var ctx, state;

function clear(){
  ctx.clearRect(0,0,dimensions.width,dimensions.height);
}

function main(){
  var canvas = document.getElementById('canvas');
  if (canvas.getContext) {
    ctx = canvas.getContext('2d');
    state = newstate();
    lines(ctx,dimensions.width,dimensions.height);
  }
}

function newstate(){
  var state = new State(verticalLines.lead*dimensions.width,horizontalLines.baseline.value*dimensions.height,0,0,0,0);
  state.velocity = 1;
  state.resistance = 0.01;
  return state;
}

// Draw the glyph guides
function lines(ctx,xscale,yscale){
  var old = ctx.strokeStyle;
  ctx.strokeStyle = "#cccccc";
  var lw = ctx.lineWidth;
  for (var line in horizontalLines) {
    ctx.beginPath();
    var l = horizontalLines[line];
    if (horizontalLines[line].value) {
      l = l.value;
      ctx.strokeStyle = dark;
    } else {
      ctx.strokeStyle = "#cccccc";
    }
    ctx.moveTo(0,l*yscale);
    ctx.lineTo(xscale,l*yscale);
    ctx.stroke();
  }
  for (var line in verticalLines) {
    ctx.beginPath();
    var l = verticalLines[line];
    if (verticalLines[line].value) {
      l = l.value;
      ctx.strokeStyle = dark;
    } else {
      ctx.strokeStyle = "#cccccc";
    }
    ctx.moveTo(xscale*l,0);
    ctx.lineTo(xscale*l,yscale);
    ctx.stroke();
  }

  ctx.strokeStyle = old;
}

function turtle(ctx,state,steps){
  ctx.clearRect(0,0,dimensions.width,dimensions.height);
  state = newstate();
  lines(ctx,dimensions.width,dimensions.height);
  var len = steps.length;
  forloop(10,0,function(){return len},1,function(i,cont){
    if(steps[i]) {
      if (!steps[i](state,ctx))
        animate(ctx,state);
      cont();
    }
    else {
      for (var x = 0; x < state.velocity; x += 0.1){
        animate(ctx,state);
      }
      cont();
    }
  },function(){
  });
}

function forloop(ms,i,to,inc,body,done){
  if (i < to()) {
    body(i,function(){
      setTimeout(function(){
        forloop(ms,i+inc,to,inc,body,done);
      },ms);
    });
  } else {
    done();
  }
}

function animate(ctx,state){
  draw(ctx,state);
  update(state);
}

function update(state){
  state.velocity = Math.max(0,state.velocity-state.resistance);
  state.x = state.x + (Math.cos(state.radian) * 1);
  state.y = state.y + (Math.sin(state.radian) * 1);
  state.pressure = (state.pressure + (Math.max(0.01,0.5 * (1 - state.velocity)))) / 2;
}

function a(ratio){
  return function(state){
    state.radian = ratio * (Math.PI * 2);
    return true;
  }
}

function l(ratio){
  return function(state){
    state.radian = state.radian - (ratio * (Math.PI * 2));
  }
}

function r(ratio){
  return function(state){
    state.radian = state.radian + (ratio * (Math.PI * 2));
  }
}

function s(speed){
  return function(state){
    state.velocity = speed;
  }
}

function c(color){
  return function(state,ctx){
    // ctx.fillStyle = color;
    return false;
  }
}

function draw(ctx,state){
  ctx.beginPath();
  ctx.arc(state.x,state.y,1.5 + state.pressure,0,Math.PI*2);
  ctx.fill();
}

function State(x,y,ra,v,r,p){
  this.x = x;
  this.y = y;
  this.radian = ra;
  this.velocity = v;
  this.resistance = r;
  this.pressure = p;
}

function randomIntFromInterval(min,max) {
  return Math.floor(Math.random()*(max-min+1)+min);
}
